# üîÅ RECOVERY.md ‚Äî –ü–ª–∞–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

–≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã MediaWiki –≤ —Å–ª—É—á–∞–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–±–æ–µ–≤.

---

## 1. ‚ùå –í—ã—Ö–æ–¥ –∏–∑ —Å—Ç—Ä–æ—è –æ–¥–Ω–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ MediaWiki

üìç –¶–µ–ª—å: —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫

```bash
# –ù–∞ –í–ú mediawiki-1:
sudo poweroff
```

‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
```
http://<nginx-lb-ip>/
```
‚úî MediaWiki –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ mediawiki-2

---

## 2. ‚ùå –í—ã—Ö–æ–¥ –∏–∑ —Å—Ç—Ä–æ—è PostgreSQL master

üìç –¶–µ–ª—å: –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ä–µ–ø–ª–∏–∫–∏

```bash
# –ù–∞ –í–ú pg-master:
sudo poweroff
```

üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ pg-replica:
```bash
sudo -u postgres psql -c "SELECT pg_is_in_recovery();"
```
‚úî –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å `t` ‚Äî —Ä–µ–ø–ª–∏–∫–∞ –≤ —Ä–µ–∂–∏–º–µ standby

---

## 3. üßπ –£–¥–∞–ª–µ–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ MediaWiki

üìç –¶–µ–ª—å: –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å /var/www/html –∏–∑ –±—ç–∫–∞–ø–∞

```bash
# –ù–∞ mediawiki-–Ω–æ–¥–µ:
sudo rm -rf /var/www/html
```

üõ† –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:
```bash
sudo tar xzf /opt/backups/files/wiki_fs_<–¥–∞—Ç–∞>.tar.gz -C /
sudo systemctl restart nginx
```

---

## 4. üõ¢Ô∏è –£–¥–∞–ª–µ–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

üìç –¶–µ–ª—å: –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏–∑ pg_dump

```bash
# –£–¥–∞–ª–µ–Ω–∏–µ –ë–î:
sudo -u postgres psql -c "DROP DATABASE my_wiki;"
```

üõ† –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:
```bash
gunzip -c /opt/backups/db/my_wiki_<–¥–∞—Ç–∞>.sql.gz | sudo -u postgres psql my_wiki
```

---

